# üç± Canteen Backend ‚Äî –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —à–∫–æ–ª—å–Ω–æ–π —Å—Ç–æ–ª–æ–≤–æ–π

–ë—ç–∫–µ–Ω–¥-—á–∞—Å—Ç—å –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –ø–∏—Ç–∞–Ω–∏—è –≤ —à–∫–æ–ª–µ.
–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ –Ω–∞ —Å—Ç–µ–∫–µ **Node.js + Express + TypeScript** —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö **SQLite**.

–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Ä–æ–ª–µ–≤—É—é –º–æ–¥–µ–ª—å –¥–æ—Å—Ç—É–ø–∞ (–£—á–µ–Ω–∏–∫, –ü–æ–≤–∞—Ä, –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä), –±–µ–∑–æ–ø–∞—Å–Ω—É—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é (JWT) –∏ –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è: –æ—Ç —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –º–µ–Ω—é –¥–æ –ø–æ–ª—É—á–µ–Ω–∏—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏.

---

## üõ† –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

- **–Ø–∑—ã–∫:** TypeScript
- **–°–µ—Ä–≤–µ—Ä:** Express.js
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** SQLite
- **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** JWT (JSON Web Tokens)
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** bcryptjs (—Ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π)
- **–û–∫—Ä—É–∂–µ–Ω–∏–µ:** Node.js

---

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å **Node.js** (v16 –∏–ª–∏ –≤—ã—à–µ).

### –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
   ```bash
   npm install

2. –∑–∞–ø—É—Å–∫–∞–µ–º:
npm run dev

–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –ø–æ –∞–¥—Ä–µ—Å—É: http://localhost:3000
–§–∞–π–ª –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö database.sqlite –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ.

3. –†–µ–∫–æ–º–µ–Ω–¥—É—é —Å–∫–∞—á–∞—Ç—å jq –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞ :
sudo pacman -S jq
4. –ü—Ä–∏–º–µ—Ä —Å–∫—Ä–∏–ø—Ç–∞ –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –±—ç–∫–µ–Ω–¥–æ–º:
#!/bin/bash

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏
URL="http://localhost:3000"
TS=$(date +%s) # –£–Ω–∏–∫–∞–ª—å–Ω–∞—è –º–µ—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–∏, —á—Ç–æ–±—ã —é–∑–µ—Ä–Ω–µ–π–º—ã –Ω–µ –ø–æ–≤—Ç–æ—Ä—è–ª–∏—Å—å

# –¶–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
GREEN='\033[0;32m'
CYAN='\033[0;36m'
NC='\033[0m' # No Color

echo -e "${CYAN}=== üöÄ –ù–ê–ß–ò–ù–ê–ï–ú –î–ï–ú–û–ù–°–¢–†–ê–¶–ò–Æ –†–ê–ë–û–¢–´ –°–¢–û–õ–û–í–û–ô ===${NC}\n"

# --- 1. –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø –ü–û–í–ê–†–ê ---
COOK_USER="cook_$TS"
echo -e "${CYAN}[1] –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –ø–æ–≤–∞—Ä–∞: $COOK_USER${NC}"
curl -s -X POST $URL/auth/register \
  -H "Content-Type: application/json" \
  -d "{\"username\": \"$COOK_USER\", \"password\": \"123\", \"role\": \"cook\"}" | jq -r '.message'

# –õ–æ–≥–∏–Ω –ø–æ–≤–∞—Ä–∞
echo -e "${CYAN}[2] –í—Ö–æ–¥ –ø–æ–≤–∞—Ä–∞ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞...${NC}"
COOK_TOKEN=$(curl -s -X POST $URL/auth/login \
  -H "Content-Type: application/json" \
  -d "{\"username\": \"$COOK_USER\", \"password\": \"123\"}" | jq -r '.token')
echo -e "${GREEN}Token –ø–æ–ª—É—á–µ–Ω!${NC}\n"

# --- 2. –î–û–ë–ê–í–õ–ï–ù–ò–ï –ú–ï–ù–Æ ---
echo -e "${CYAN}[3] –ü–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª—è–µ—Ç –±–ª—é–¥–∞ –≤ –º–µ–Ω—é...${NC}"
# –ë–ª—é–¥–æ 1
curl -s -X POST $URL/cook/menu \
  -H "Authorization: Bearer $COOK_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"name": "–ë–æ—Ä—â –ú–æ—Å–∫–æ–≤—Å–∫–∏–π", "description": "–° –≥–æ–≤—è–¥–∏–Ω–æ–π", "price": 150, "type": "lunch", "available_qty": 50}' | jq -r '.message'
# –ë–ª—é–¥–æ 2
curl -s -X POST $URL/cook/menu \
  -H "Authorization: Bearer $COOK_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"name": "–ß–∞–π —Å —Å–∞—Ö–∞—Ä–æ–º", "description": "–ß–µ—Ä–Ω—ã–π", "price": 20, "type": "breakfast", "available_qty": 100}' | jq -r '.message'
echo ""

# --- 3. –£–ß–ï–ù–ò–ö ---
STUDENT_USER="student_$TS"
echo -e "${CYAN}[4] –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º —É—á–µ–Ω–∏–∫–∞: $STUDENT_USER${NC}"
curl -s -X POST $URL/auth/register \
  -H "Content-Type: application/json" \
  -d "{\"username\": \"$STUDENT_USER\", \"password\": \"123\", \"role\": \"student\", \"allergies\": \"nuts\"}" | jq -r '.message'

# –õ–æ–≥–∏–Ω —É—á–µ–Ω–∏–∫–∞
STUDENT_TOKEN=$(curl -s -X POST $URL/auth/login \
  -H "Content-Type: application/json" \
  -d "{\"username\": \"$STUDENT_USER\", \"password\": \"123\"}" | jq -r '.token')

# –ü–æ–∫—É–ø–∫–∞
echo -e "${CYAN}[5] –£—á–µ–Ω–∏–∫ –ø–æ–∫—É–ø–∞–µ—Ç –ë–æ—Ä—â (ID –±–µ—Ä–µ–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏, –¥–æ–ø—É—Å—Ç–∏–º –ø–æ—Å–ª–µ–¥–Ω–µ–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω–æ–µ)...${NC}"
# (–î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –≤ —Å–∫—Ä–∏–ø—Ç–µ –±–µ—Ä–µ–º ID=1, –Ω–æ –≤ —Ä–µ–∞–ª–µ –ª—É—á—à–µ –ø–∞—Ä—Å–∏—Ç—å –º–µ–Ω—é)
curl -s -X POST $URL/student/buy \
  -H "Authorization: Bearer $STUDENT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"menu_item_id": 1, "type": "single"}' | jq

# –û—Ç–∑—ã–≤
echo -e "${CYAN}[6] –£—á–µ–Ω–∏–∫ –æ—Å—Ç–∞–≤–ª—è–µ—Ç –æ—Ç–∑—ã–≤...${NC}"
curl -s -X POST $URL/student/reviews \
  -H "Authorization: Bearer $STUDENT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"menu_item_id": 1, "rating": 5, "comment": "–û—á–µ–Ω—å –≤–∫—É—Å–Ω—ã–π –±–æ—Ä—â, —Å–ø–∞—Å–∏–±–æ!"}' | jq
echo ""

# --- 4. –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–† ---
ADMIN_USER="admin_$TS"
echo -e "${CYAN}[7] –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –∞–¥–º–∏–Ω–∞: $ADMIN_USER${NC}"
curl -s -X POST $URL/auth/register \
  -H "Content-Type: application/json" \
  -d "{\"username\": \"$ADMIN_USER\", \"password\": \"123\", \"role\": \"admin\"}" | jq -r '.message'

# –õ–æ–≥–∏–Ω –∞–¥–º–∏–Ω–∞
ADMIN_TOKEN=$(curl -s -X POST $URL/auth/login \
  -H "Content-Type: application/json" \
  -d "{\"username\": \"$ADMIN_USER\", \"password\": \"123\"}" | jq -r '.token')

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
echo -e "${CYAN}[8] –ê–¥–º–∏–Ω —Å–º–æ—Ç—Ä–∏—Ç –≤—ã—Ä—É—á–∫—É...${NC}"
curl -s $URL/admin/stats -H "Authorization: Bearer $ADMIN_TOKEN" | jq

echo -e "\n${GREEN}=== ‚úÖ –î–ï–ú–û–ù–°–¢–†–ê–¶–ò–Ø –ó–ê–í–ï–†–®–ï–ù–ê ===${NC}"


–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≥–æ–Ω—è–µ—Ç –≤–µ—Å—å —Ü–∏–∫–ª –∂–∏–∑–Ω–∏ —Å—Ç–æ–ª–æ–≤–æ–π: —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤—Å–µ—Ö —Ä–æ–ª–µ–π, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ–Ω—é, –ø–æ–∫—É–ø–∫–∞, –æ—Ç–∑—ã–≤—ã –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞. –û–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞ (—Å –º–µ—Ç–∫–æ–π –≤—Ä–µ–º–µ–Ω–∏), –ø–æ—ç—Ç–æ–º—É –µ–≥–æ –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –º–Ω–æ–≥–æ —Ä–∞–∑, –∏ –æ—à–∏–±–∫–∏ "User exists" –Ω–µ –±—É–¥–µ—Ç.